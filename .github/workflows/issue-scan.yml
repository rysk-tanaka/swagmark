name: Issue Scan

on:
  schedule:
    - cron: "0 0 * * 0"
  workflow_dispatch:

concurrency:
  group: issue-scan
  cancel-in-progress: false

jobs:
  scan:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      issues: write
      contents: read
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 1

      - name: Scan open issues
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          claude_args: '--max-turns 3 --model claude-haiku-4-5 --allowed-tools "Bash(gh issue *),Bash(gh label create *)"'
          prompt: |
            ã‚ãªãŸã¯ Issue ãƒˆãƒªã‚¢ãƒ¼ã‚¸æ‹…å½“ã§ã™ã€‚ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„ã€‚

            ## æ‰‹é †

            1. `gh issue list --state open --json number,title,labels --limit 50` ã§ open issue ã‚’å–å¾—
            2. ä»¥ä¸‹ã®ãƒ©ãƒ™ãƒ«ãŒä»˜ã„ã¦ã„ã‚‹ issue ã¯ã‚¹ã‚­ãƒƒãƒ—: `claude-scanned`, `claude-implement`, `difficulty/easy`, `difficulty/medium`, `difficulty/hard`
            3. ã‚¹ã‚­ãƒƒãƒ—å¯¾è±¡å¤–ã® issue ã‹ã‚‰æœ€å¤§3ä»¶ã‚’é¸ã³ã€å„ issue ã®å†…å®¹ã‚’ `gh issue view <number>` ã§ç¢ºèª
            4. å„ issue ã‚’é›£æ˜“åº¦åˆ¤å®šã™ã‚‹
               - easy: å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®å°ã•ãªå¤‰æ›´ã€æ˜ç¢ºãªä¿®æ­£ç®‡æ‰€ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è»½å¾®ãªä¿®æ­£
               - medium: è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ãŸãŒã‚‹å¤‰æ›´ã€è¨­è¨ˆåˆ¤æ–­ãŒå¿…è¦ã€ãƒ†ã‚¹ãƒˆã®è¿½åŠ ãƒ»ä¿®æ­£ãŒå¿…è¦
               - hard: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´ã€å¤–éƒ¨ä¾å­˜ã®è¿½åŠ ã€å¤§è¦æ¨¡ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
            5. ãƒ©ãƒ™ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ `gh label create` ã§ä½œæˆã—ã¦ã‹ã‚‰ä»˜ä¸ã™ã‚‹
            6. é›£æ˜“åº¦ã«å¿œã˜ã¦ãƒ©ãƒ™ãƒ«ã‚’ä»˜ä¸
               - easy â†’ `difficulty/easy` + `claude-implement` + `claude-scanned`
               - medium â†’ `difficulty/medium` + `claude-scanned`
               - hard â†’ `difficulty/hard` + `claude-scanned`
            7. å„ issue ã«æ—¥æœ¬èªã§åˆ¤å®šç†ç”±ã‚’ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ`gh issue comment`ï¼‰

            ## ã‚³ãƒ¡ãƒ³ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

            ```text
            ## è‡ªå‹•ãƒˆãƒªã‚¢ãƒ¼ã‚¸çµæœ

            é›£æ˜“åº¦: easy / medium / hard
            ç†ç”±: ï¼ˆåˆ¤å®šç†ç”±ã‚’ç°¡æ½”ã«è¨˜è¿°ï¼‰
            ```

            ## æ³¨æ„äº‹é …

            - ãƒ©ãƒ™ãƒ«ä»˜ä¸ã¨ã‚³ãƒ¡ãƒ³ãƒˆä»¥å¤–ã®å¤‰æ›´ã¯è¡Œã‚ãªã„ã§ãã ã•ã„
            - å¯¾è±¡ issue ãŒ0ä»¶ã®å ´åˆã¯ä½•ã‚‚ã›ãšçµ‚äº†ã—ã¦ãã ã•ã„

            ---
            ğŸ¤– ãƒ¢ãƒ‡ãƒ«: [å®Ÿéš›ã®ãƒ¢ãƒ‡ãƒ«å] / ğŸ’° ã‚³ã‚¹ãƒˆ: å…¥åŠ›[N]ãƒˆãƒ¼ã‚¯ãƒ³, å‡ºåŠ›[M]ãƒˆãƒ¼ã‚¯ãƒ³, $[é‡‘é¡]
