name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize, labeled, ready_for_review, reopened]

jobs:
  claude-review:
    if: |
      contains(github.event.pull_request.labels.*.name, 'claude-review')

    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 1

      - name: Run Claude Code Review
        id: claude-review
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          track_progress: ${{ github.event.action != 'labeled' }}
          use_sticky_comment: true

          prompt: |
            ã“ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ—¥æœ¬èªã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
            - ã‚³ãƒ¼ãƒ‰å“è³ªã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
            - æ½œåœ¨çš„ãªãƒã‚°ã‚„å•é¡Œ
            - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è€ƒæ…®äº‹é …
            - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µ

            å…·ä½“çš„ãªå•é¡Œç®‡æ‰€ã¯ mcp__github_inline_comment__create_inline_comment ã§ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ã‘ã¦ãã ã•ã„ã€‚
            å…·ä½“çš„ãªæŒ‡æ‘˜ã¯ã™ã¹ã¦ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆã«é›†ç´„ã—ã¦ãã ã•ã„ã€‚

            æœ€çµ‚å‡ºåŠ›ã¯ä»¥ä¸‹ã®å½¢å¼ã§ã‚µãƒãƒªãƒ¼ã®ã¿è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚

            ## ç·åˆè©•ä¾¡
            æ‰¿èª / è¦ä¿®æ­£ / ã‚³ãƒ¡ãƒ³ãƒˆ

            ## æ¦‚è¦
            ï¼ˆå¤‰æ›´å†…å®¹ã®è¦ç´„ã‚’1-2æ–‡ã§ï¼‰

            ## è‰¯ã„ç‚¹
            - ï¼ˆä¸»è¦ãªè‰¯ã„ç‚¹ã‚’2-3å€‹ï¼‰

            ## æŒ‡æ‘˜ä»¶æ•°
            ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆ: Nä»¶

            ---
            ä½¿ç”¨ã—ãŸãƒ¢ãƒ‡ãƒ«åã¨å®Ÿéš›ã®ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã€æ¨å®šã‚³ã‚¹ãƒˆã‚’è¨ˆç®—ã—ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
            å½¢å¼: ğŸ¤– ãƒ¢ãƒ‡ãƒ«: [å®Ÿéš›ã®ãƒ¢ãƒ‡ãƒ«å] / ğŸ’° ã‚³ã‚¹ãƒˆ: å…¥åŠ›[N]ãƒˆãƒ¼ã‚¯ãƒ³, å‡ºåŠ›[M]ãƒˆãƒ¼ã‚¯ãƒ³, $[é‡‘é¡]

          claude_args: '--model claude-sonnet-4-6 --allowed-tools "mcp__github_inline_comment__create_inline_comment,Bash(gh issue view:*),Bash(gh search:*),Bash(gh issue list:*),Bash(gh pr diff:*),Bash(gh pr view:*),Bash(gh pr list:*)"'
