name: Claude Code Review

on:
  # 1. claude-reviewãƒ©ãƒ™ãƒ«ãŒä»˜ã„ãŸPR
  pull_request:
    types: [opened, synchronize, labeled]

  # 2. PRã‚³ãƒ¡ãƒ³ãƒˆã§@claude-reviewã‚’ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³
  issue_comment:
    types: [created]

  # 3. æ‰‹å‹•å®Ÿè¡Œ
  workflow_dispatch:
    inputs:
      pr_number:
        description: "PRç•ªå·ã‚’æŒ‡å®šã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿè¡Œ"
        required: true
        type: string

jobs:
  claude-review:
    if: |
      (github.event_name == 'pull_request' && contains(github.event.pull_request.labels.*.name, 'claude-review')) ||
      (github.event_name == 'issue_comment' && github.event.issue.pull_request && contains(github.event.comment.body, '@claude-review')) ||
      (github.event_name == 'workflow_dispatch')

    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 1

      - name: Run Claude Code Review
        id: claude-review
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          track_progress: ${{ github.event.action != 'labeled' }}

          prompt: |
            ã“ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ—¥æœ¬èªã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¦ãã ã•ã„ï¼š
            - ã‚³ãƒ¼ãƒ‰å“è³ªã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
            - æ½œåœ¨çš„ãªãƒã‚°ã‚„å•é¡Œ
            - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è€ƒæ…®äº‹é …
            - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µ

            å›ç­”ã¯ç°¡æ½”ã«ã¾ã¨ã‚ã€ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š

            ## âœ… è‰¯ã„ç‚¹
            - ï¼ˆä¸»è¦ãªè‰¯ã„ç‚¹ã‚’2-3å€‹ï¼‰

            ## âš ï¸ æ”¹å–„ç‚¹
            - ï¼ˆé‡è¦ãªå•é¡Œã®ã¿1-3å€‹ï¼‰

            ## ç·åˆè©•ä¾¡
            æ‰¿èª / è¦ä¿®æ­£ / ã‚³ãƒ¡ãƒ³ãƒˆ

            ---
            ä½¿ç”¨ã—ãŸãƒ¢ãƒ‡ãƒ«åã¨å®Ÿéš›ã®ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã€æ¨å®šã‚³ã‚¹ãƒˆã‚’è¨ˆç®—ã—ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
            å½¢å¼: ğŸ¤– ãƒ¢ãƒ‡ãƒ«: [å®Ÿéš›ã®ãƒ¢ãƒ‡ãƒ«å] / ğŸ’° ã‚³ã‚¹ãƒˆ: å…¥åŠ›[N]ãƒˆãƒ¼ã‚¯ãƒ³, å‡ºåŠ›[M]ãƒˆãƒ¼ã‚¯ãƒ³, $[é‡‘é¡]

          # See https://github.com/anthropics/claude-code-action/blob/main/docs/usage.md
          # or https://docs.claude.com/en/docs/claude-code/cli-reference for available options
          claude_args: '--model claude-sonnet-4-6 --allowed-tools "Bash(gh issue view:*),Bash(gh search:*),Bash(gh issue list:*),Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*),Bash(gh pr list:*)"'
